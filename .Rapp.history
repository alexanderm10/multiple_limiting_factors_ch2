ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	theme_bw()
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))
summary(climate.markers)
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.marker$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Suppressed precip years")
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	scale_x_continuous(breaks = seq(1940, 2015, by=10),labels = c("1940",rep("",1), "1960",rep("",1), "1980",rep("",1), "2000",rep("",1), "2010",rep("",1))) +#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Suppressed temp years")
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	scale_x_continuous(breaks = seq(1940, 2020, by=10),labels = c("1940",rep("",1), "1960",rep("",1), "1980",rep("",1), "2000",rep("",1), "2010",rep("",1))) +#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Suppressed temp years")
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	scale_x_continuous(breaks = prettybreaks()) +#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Suppressed temp years")
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	scale_x_continuous(breaks = pretty_breaks()) +#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Suppressed temp years")
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Suppressed temp years")
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Suppressed temp years")
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Suppressed precip years")
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="M0",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="M0" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="M0",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="M0" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Suppressed precip years")
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="M0",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="M0" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
  scale_x_continuous(expand=c(0,0), name="Year") +#
  scale_y_continuous(expand=c(0,0), name="BAI") +#
  # facet_wrap(~TreeID, scales="free_y", space="free") +#
  # geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="M0",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="M0" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Suppressed temp years")
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="M0",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5)
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Ohio Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="OhioSuppressed precip years")
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Suppressed precip years")
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="M0",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="M0" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Suppressed precip years")
summary(climate.markers)
data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="M0",]
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Suppressed precip years")
pdf("figures/Prelim_Figures/suppressed_bai_climatemarkers.pdf", width= 13, height = 8.5)#
# Missouri Ozark#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Suppressed precip years")#
# Morgan Monroe#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Suppressed precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Ohio Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="OhioSuppressed precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Suppressed precip years")#
# Howland#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Howland Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + + labs(title="Howland Suppressed precip years")#
dev.off()
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$Dtate=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$Dtate=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$Dtate=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$Dtate=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Dominant precip years")#
# Morgan Monroe#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$Dtate=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$Dtate=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$Dtate=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$Dtate=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Dominant precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$Dtate=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$Dtate=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Ohio Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$Dtate=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$Dtate=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="OhioDominant precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$Dtate=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$Dtate=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$Dtate=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$Dtate=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Dominant precip years")#
# Howland#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$Dtate=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$Dtate=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Howland Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$Dtate=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$Dtate=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + + labs(title="Howland Dominant precip years")
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$Dtate=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$Dtate=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")
dev.off()
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$Dtate=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$Dtate=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")
data.graph[data.graph$Canopy.Class=="D" & data.graph$Dtate=="MO",]
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("orange", "lightblue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Dominant precip years")
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Dominant precip years")
pdf("figures/Prelim_Figures/bai_climatemarkers_dominant.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Dominant precip years")#
# Morgan Monroe#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Dominant precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Ohio Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="OhioDominant precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Dominant precip years")#
# Howland#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Howland Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + + labs(title="Howland Dominant precip years")#
dev.off()#
# Intermediate trees#
# Missouri Ozark#
#
pdf("figures/Prelim_Figures/bai_climatemarkers_Intermediate.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Suppressed precip years")#
# Morgan Monroe#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Suppressed precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Ohio Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="OhioSuppressed precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Suppressed precip years")#
# Howland#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Howland Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + + labs(title="Howland Suppressed precip years")#
dev.off()#
# Suppressed trees#
# Missouri Ozark#
pdf("figures/Prelim_Figures/bai_climatemarkers_suppressed.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Suppressed precip years")#
# Morgan Monroe#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Suppressed precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Ohio Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="OhioSuppressed precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Suppressed precip years")#
# Howland#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Howland Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + + labs(title="Howland Suppressed precip years")#
dev.off()
pdf("figures/Prelim_Figures/bai_climatemarkers_dominant.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Dominant precip years")#
# Morgan Monroe#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Dominant precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Ohio Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="OhioDominant precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Dominant precip years")#
# Howland#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Howland Dominant temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="D" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + + labs(title="Howland Dominant precip years")#
dev.off()#
# Intermediate trees#
# Missouri Ozark#
#
pdf("figures/Prelim_Figures/bai_climatemarkers_Intermediate.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Intermediate temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Intermediate precip years")#
# Morgan Monroe#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Intermediate temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Intermediate precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Ohio Intermediate temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="OhioIntermediate precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Intermediate temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Intermediate precip years")#
# Howland#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Howland Intermediate temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + + labs(title="Howland Intermediate precip years")#
dev.off()#
# Suppressed trees#
# Missouri Ozark#
pdf("figures/Prelim_Figures/bai_climatemarkers_suppressed.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Suppressed precip years")#
# Morgan Monroe#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Suppressed precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Ohio Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="OhioSuppressed precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Suppressed precip years")#
# Howland#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Howland Suppressed temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="S" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + + labs(title="Howland Suppressed precip years")#
dev.off()#
# Plotting the Effects#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))#
#
pdf("figures/Prelim_Figures/gam2_influence_in_time.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State ~ Canopy.Class, scale="free") +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_line(aes(x=Year, y=fit.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=fit.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=fit.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Effect on BAI (mm"^"2", "y"^"-1",")"))))#
dev.off()	#
#
pdf("figures/Prelim_Figures/gam2_influence_in_time_weights.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
dev.off()
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + + labs(title="Howland Intermediate precip years")
pdf("figures/Prelim_Figures/bai_climatemarkers_Intermediate.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Intermediate temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="MO",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Intermediate precip years")#
# Morgan Monroe#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Intermediate temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="IN",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Intermediate precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Ohio Intermediate temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="OH",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="OhioIntermediate precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Intermediate temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="MA",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Intermediate precip years")#
# Howland#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Howland Intermediate temp years")#
ggplot(data.graph[data.graph$Canopy.Class=="I" & data.graph$State=="ME",]) +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Howland Intermediate precip years")#
dev.off()
load("processed_data/climate_markeryears.Rdata")#
summary(climate.markers)#
climate.markers$State <- recode(climate.markers$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")
library(ggplot2)#
library(car)#
load(file="processed_data/gamm_weights/gam1_weights.Rdata")#
#
summary(gam1.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam1.weights[,which(substr(names(gam1.weights),1,3)=="fit")] <- exp(gam1.weights[,which(substr(names(gam1.weights),1,3)=="fit")] )#
#
othervars <- c("Year", "Site", "group", "Model")#
#
data.graph1 <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam1.weights[gam1.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam1.weights$wts.check <- rowSums(abs(gam1.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam1.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$group, data.graph$Site, decreasing=F),]#
summary(data.graph)#
#
plot.rgb <- function(STATE, SPP, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$group==SPP,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.precip"   ]))) }   # blue#
#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))#
#
summary(data.graph[!data.graph$group %in% c("BETULA", "CARYA", "FAGR", "FRAX", "SAAL"),])
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(group~.) + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI")
summary(data.graph)
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(group~.) + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")
ggplot(data.graph[data.graph$State=="MO",]) + + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Spp precip years")
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Spp precip years")
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Spp temp years")
pdf("figures/Prelim_Figures/bai_climatemarkers_SPP.pdf", width= 13, height = 8.5)#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Spp temp years")#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Spp precip years")#
# Morgan Monroe#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Spp temp years")#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Spp precip years")#
# Oak Openings#
#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Oak Openings Spp temp years")#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Oak Openings Spp precip years")#
# Harvard#
#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Spp temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Spp precip years")#
# Howland#
#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Howland Spp temp years")#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Howland Spp precip years")#
dev.off()
#############################################################################
# Looking at the BAI for each canopy class in reference to climate factors#
#############################################################################
pdf("figures/Prelim_Figures/bai_climatemarkers_SPP.pdf", width= 13, height = 8.5)#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Spp temp years")#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Spp precip years")#
# Morgan Monroe#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Spp temp years")#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Spp precip years")#
# Oak Openings#
#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Oak Openings Spp temp years")#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Oak Openings Spp precip years")#
# Harvard#
#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Spp temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Spp precip years")#
# Howland#
#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Howland Spp temp years")#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Howland Spp precip years")#
dev.off()
ggplot(data.graph$State=="MO",]) + facet_grid(Canopy.Class~.) + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")
ggplot(data.graph$State=="MO",]) + facet_grid(Canopy.Class~.) + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)
library(ggplot2)#
require(car)#
#
load(file="processed_data/gamm_weights/gam2_weights.Rdata")#
#
summary(gam2.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] <- exp(gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] )#
othervars <- c("Year", "Site", "Canopy.Class", "Model")#
#
data.graph1 <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam2.weights[gam2.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam2.weights$wts.check <- rowSums(abs(gam2.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam2.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$Canopy.Class, data.graph$Site, decreasing=F),]#
plot.rgb <- function(STATE, CC, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.precip"   ]))) }   # blue#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))
load("processed_data/climate_markeryears.Rdata")#
summary(climate.markers)#
climate.markers$State <- recode(climate.markers$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")
ggplot(data.graph$State=="MO",]) + facet_grid(Canopy.Class~.) + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")
summary(data.graph)
ggplot(data.graph$State=="MO",]) + facet_grid(Canopy.Class~.) + #
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")
ggplot(data.graph$State=="MO",]) + facet_grid(~Canopy.Class) + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")
ggplot(data.graph$State=="MO",]) + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(~Canopy.Class) + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~.) + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Dominant temp years")
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Canopy precip years")
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1940,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Canopy temp years")#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1940,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Canopy precip years")
scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Oak Openings Canopy temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Oak Openings Canopy precip years")
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Howland Canopy temp years")#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="HowlandCanopy precip years")
library(ggplot2)#
require(car)#
#
load(file="processed_data/gamm_weights/gam2_weights.Rdata")#
#
summary(gam2.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] <- exp(gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] )#
othervars <- c("Year", "Site", "Canopy.Class", "Model")#
#
data.graph1 <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam2.weights[gam2.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam2.weights$wts.check <- rowSums(abs(gam2.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam2.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$Canopy.Class, data.graph$Site, decreasing=F),]#
plot.rgb <- function(STATE, CC, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.precip"   ]))) }   # blue#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))
load("processed_data/climate_markeryears.Rdata")#
summary(climate.markers)#
climate.markers$State <- recode(climate.markers$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Canopy temp years")#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Canopy precip years")#
# Morgan Monroe#
#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Canopy temp years")#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Canopy precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Oak Openings Canopy temp years")#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Oak Openings Canopy precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x ="Harvard Canopy temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Canopy precip years")#
# Howland#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Howland Canopy temp years")#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="HowlandCanopy precip years")#
dev.off()#
# Plotting the Effects#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))#
#
pdf("figures/Prelim_Figures/gam2_influence_in_time.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State ~ Canopy.Class, scale="free") +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_line(aes(x=Year, y=fit.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=fit.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=fit.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Effect on BAI (mm"^"2", "y"^"-1",")"))))#
dev.off()	#
#
pdf("figures/Prelim_Figures/gam2_influence_in_time_weights.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
dev.off()
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Canopy temp years")#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Canopy precip years")#
# Morgan Monroe#
#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Canopy temp years")#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Canopy precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Oak Openings Canopy temp years")#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Oak Openings Canopy precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x ="Harvard Canopy temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Canopy precip years")#
# Howland#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Howland Canopy temp years")#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="HowlandCanopy precip years")#
dev.off()#
# Plotting the Effects#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))#
#
pdf("figures/Prelim_Figures/gam2_influence_in_time.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State ~ Canopy.Class, scale="free") +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_line(aes(x=Year, y=fit.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=fit.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=fit.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Effect on BAI (mm"^"2", "y"^"-1",")"))))
pdf("figures/Prelim_Figures/bai_climatemarkers_dominant.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Canopy temp years")#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Canopy precip years")#
# Morgan Monroe#
#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Canopy temp years")#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Canopy precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Oak Openings Canopy temp years")#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Oak Openings Canopy precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x ="Harvard Canopy temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Canopy precip years")#
# Howland#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Howland Canopy temp years")#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="HowlandCanopy precip years")#
dev.off()
pdf("figures/Prelim_Figures/bai_climatemarkers_canopy.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Canopy temp years")#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Canopy precip years")#
# Morgan Monroe#
#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Canopy temp years")#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Canopy precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Oak Openings Canopy temp years")#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Oak Openings Canopy precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x ="Harvard Canopy temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Canopy precip years")#
# Howland#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Howland Canopy temp years")#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="HowlandCanopy precip years")#
dev.off()
summary(data.graph)
library(ggplot2)#
library(car)#
load(file="processed_data/gamm_weights/gam1_weights.Rdata")#
#
summary(gam1.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam1.weights[,which(substr(names(gam1.weights),1,3)=="fit")] <- exp(gam1.weights[,which(substr(names(gam1.weights),1,3)=="fit")] )#
#
othervars <- c("Year", "Site", "group", "Model")#
#
data.graph1 <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam1.weights[gam1.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam1.weights$wts.check <- rowSums(abs(gam1.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam1.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$group, data.graph$Site, decreasing=F),]#
summary(data.graph)#
#
plot.rgb <- function(STATE, SPP, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$group==SPP,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.precip"   ]))) }   # blue#
#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))#
#
summary(data.graph[!data.graph$group %in% c("BETULA", "CARYA", "FAGR", "FRAX", "SAAL"),])
library(ggplot2)#
require(car)#
#
load(file="processed_data/gamm_weights/gam2_weights.Rdata")#
#
summary(gam2.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] <- exp(gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] )#
othervars <- c("Year", "Site", "Canopy.Class", "Model")#
#
data.graph1 <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam2.weights[gam2.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam2.weights$wts.check <- rowSums(abs(gam2.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam2.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$Canopy.Class, data.graph$Site, decreasing=F),]#
plot.rgb <- function(STATE, CC, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.precip"   ]))) }   # blue#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))
summary(data.graph)
library(ggplot2)#
library(car)#
load(file="processed_data/gamm_weights/gam4_weights.Rdata")#
#
summary(gam4.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.fits2 <- c("tmean.bai", "precip.bai", "dbh.bai", "fit.full.bai", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam4.weights[,which(substr(names(gam4.weights),1,3)=="fit")] <- exp(gam4.weights[,which(substr(names(gam4.weights),1,3)=="fit")] )#
#
othervars <- c("Year", "Site","Model")#
#
data.graph1 <- aggregate(gam4.weights[,factors.fits], by = gam4.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam4.weights[,factors.fits], by = gam4.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam4.weights[,factors.fits], by = gam4.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam4.weights[,factors.weights]), by = gam4.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam4.weights[,factors.weights]), by = gam4.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam4.weights[,factors.weights]), by = gam4.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam4.weights[gam4.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam4.weights$wts.check <- rowSums(abs(gam4.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam4.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$Site, decreasing=F),]#
summary(data.graph)#
#
plot.rgb <- function(STATE,SIZE){	geom_point(data=data.graph[data.graph$State==STATE,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE,"weight.precip"   ]))) }   # blue#
#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))
summary(data.graph)
library(ggplot2)#
require(car)#
#
load(file="processed_data/gamm_weights/gam2_weights.Rdata")#
#
summary(gam2.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] <- exp(gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] )#
othervars <- c("Year", "Site", "Canopy.Class", "Model")#
#
data.graph1 <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam2.weights[gam2.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam2.weights$wts.check <- rowSums(abs(gam2.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam2.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$Canopy.Class, data.graph$Site, decreasing=F),]#
plot.rgb <- function(STATE, CC, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.precip"   ]))) }   # blue#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))
pdf("figures/Prelim_Figures/bai_climatemarkers_canopy.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1950,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Canopy temp years")#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1950,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Canopy precip years")#
# Morgan Monroe#
#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1950,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Canopy temp years")#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1950,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Canopy precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1950,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Oak Openings Canopy temp years")#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1950,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Oak Openings Canopy precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1950,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x ="Harvard Canopy temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1950,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Canopy precip years")#
# Howland#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1950,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Howland Canopy temp years")#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1950,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="HowlandCanopy precip years")#
dev.off()
load("processed_data/climate_markeryears.Rdata")#
summary(climate.markers)#
climate.markers$State <- recode(climate.markers$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")
pdf("figures/Prelim_Figures/bai_climatemarkers_canopy.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1950,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Canopy temp years")#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1950,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Canopy precip years")#
# Morgan Monroe#
#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1950,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Canopy temp years")#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1950,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Canopy precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1950,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Oak Openings Canopy temp years")#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1950,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Oak Openings Canopy precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1950,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x ="Harvard Canopy temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1950,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Canopy precip years")#
# Howland#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1950,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Howland Canopy temp years")#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1950,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="HowlandCanopy precip years")#
dev.off()
library(ggplot2)#
library(car)#
load(file="processed_data/gamm_weights/gam4_weights.Rdata")#
#
summary(gam4.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.fits2 <- c("tmean.bai", "precip.bai", "dbh.bai", "fit.full.bai", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam4.weights[,which(substr(names(gam4.weights),1,3)=="fit")] <- exp(gam4.weights[,which(substr(names(gam4.weights),1,3)=="fit")] )#
#
othervars <- c("Year", "Site","Model")#
#
data.graph1 <- aggregate(gam4.weights[,factors.fits], by = gam4.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam4.weights[,factors.fits], by = gam4.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam4.weights[,factors.fits], by = gam4.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam4.weights[,factors.weights]), by = gam4.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam4.weights[,factors.weights]), by = gam4.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam4.weights[,factors.weights]), by = gam4.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam4.weights[gam4.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam4.weights$wts.check <- rowSums(abs(gam4.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam4.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$Site, decreasing=F),]#
summary(data.graph)#
#
plot.rgb <- function(STATE,SIZE){	geom_point(data=data.graph[data.graph$State==STATE,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE,"weight.precip"   ]))) }   # blue#
#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))
load("processed_data/climate_markeryears.Rdata")#
summary(climate.markers)#
climate.markers$State <- recode(climate.markers$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")
ggplot(data.graph) + facet_grid(Site~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1950,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Site temp years")
ggplot(data.graph) + facet_grid(State~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1950,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Site temp years")
ggplot(data.graph) + facet_grid(State~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Site temp years")
ggplot(data.graph) + facet_grid(State~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("brown", "dodgerblue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Site precip years")
pdf("figures/Prelim_Figures/bai_climatemarkers_site.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Site temp years")#
ggplot(data.graph) + facet_grid(State~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("brown", "dodgerblue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Site precip years")#
dev.off()
ggplot(data.graph) + facet_grid(State~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Site temp years")#
ggplot(data.graph) + facet_grid(State~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Site precip years")
pdf("figures/Prelim_Figures/bai_climatemarkers_site.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Site temp years")#
ggplot(data.graph) + facet_grid(State~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Site precip years")#
dev.off()
rm(list=ls())
library(mgcv)#
library(ggplot2)#
library(car)#
# Christy's GAMM code#
#
# gam1 <- gamm(Y ~  s(Biomass, bs="cr", k=3, by=PFT) + s(tair, k=k, by=PFT) + s(precipf, k=k, by=PFT) + s(CO2, k=k, by=PFT), random=list(PlotID=~1), data=data) #
#
# Loading in my data#
#
data.use <- read.csv("processed_data/AllSites_tree_plus_climate_and_BA.csv", header=T)#
#
data.use$group <- data.use$Species#
data.use$group <- recode(data.use$group, "'CAOV' = 'CARYA'; 'CACO' = 'CARYA'; #
  							'CATE' = 'CARYA'; 'ACSAC' = 'ACSA'; 'BEAL' = 'BETULA'; 'BELE' = 'BETULA'; 'QUMU' = 'QUAL'")#
#
data.use$group.plot <- as.factor(paste(data.use$group, data.use$PlotID, sep="."))#
#
data.use$Canopy.Class <- recode(data.use$Canopy.Class, "'C' = 'D'")#
summary(data.use)#
# reducing the amount of data for the test runs#
sites.use <- c("Harvard", "Howland", "Morgan Monroe State Park", "Oak Openings Toledo", "Missouri Ozark")#
#
test <- data.use[data.use$Site %in% sites.use & !is.na(data.use$RW) & !is.na(data.use$BA.inc),]#
summary(test)#
#
test$group.cc <- as.factor(paste(test$group, test$Canopy.Class, sep="."))#
summary(test)#
# Get a list of what predictors & responses I'm using#
predictors.all <- c("tmean", "precip", "Species", "dbh.recon", "Canopy.Class", "spp.plot", "group", "group.plot", "group.cc", "Site") #
#
# Getting rid of observations that have NAs in the important variables#
test <- test[complete.cases(test[,predictors.all]),]#
test <- test[test$Live.Dead=="LIVE" & !test$Canopy.Class=="F",]#
#
# Subsetting to a set of species that we have enough data to feel good about#
#species.use <- c("TSCA", "QURU", "ACRU", "BEAL", "ACSA", "LITU", "QUAL", "CAOV", "CACO", "CATE", "JUVI", "QUVE", "PCRU", "THOC", "PIST")#
group.use <- c("ACRU", "ACSA", "BETULA", "CARYA", "FAGR", "FRAX", "PIST", "QUAL", "QURU", "QUVE", "SAAL", "TSCA", "ULRU")#
#
test <- test[test$group %in% group.use,]#
#
summary(test)#
#
par(new=F)#
plot(test[test$TreeID=="MMA003", "BA.inc"]~ test[test$TreeID=="MMA003","Year"], type="l")#
test$log.dbh <- log(test$dbh.recon)#
summary(test)#
#
summary(test)#
summary(test$Live.Dead)#
summary(test$Canopy.Class)#
# RW <- test$RW#
# temp <- test$tmean#
# precip <- test$precip#
# canopy <- test$Canopy.Class#
# size <- test$DBH..cm.#
# species <- unique(test$Species)#
# library(ggplot2)#
# ggplot(data=test) +#
   # facet_wrap(~PlotID) +#
   # geom_histogram(aes(x=dbh.recon))#
# ggplot(data=test) +#
   # facet_wrap(~Species) +#
   # geom_histogram(aes(x=dbh.recon))#
# hist(test$dbh.recon)#
# test2 <- test[test$group %in% c("QURU", "ACRU") & test$Year>=1980,]#
# test2 <- test[test$group %in% c("QURU", "ACRU"),]#
test2 <- test[test$Site %in% c("Morgan Monroe State Park", "Harvard"), ]#
# test2$log.dbh <- log(test2$dbh.recon)#
# summary(test2)#
summary(test)#
test[test$BA.inc==0, "BA.inc"] <- 1e-6#
save(test, file="ch2_combined_data_use.Rdata")#
# test.gam3 <- test#
# test.gam3$Canopy.Class <- recode(test.gam3$Canopy.Class, "'C' = 'D'")#
# summary(test.gam3)
summary(test)
gam2 <- gamm(log(BA.inc)~ s(tmean, k=3, by=Canopy.Class) +#
                  s(precip, k=3, by=Canopy.Class) +#
                  s(dbh.recon, k=3, by=Canopy.Class) +#
                  Site + Canopy.Class + group,#
                  random=list(Site=~1, PlotID=~1, TreeID=~1),#
                  data=test)
save(gam2, file="processed_data/gam_results/gam2_climate_by_canopyclass.Rdata")
n <- 100#
data <- test#
		n.out = n#
#
		new.dat <- data.frame(Model="species_response",#
							  Extent=as.factor(paste(min(data$Year), max(data$Year), sep="-")))#
		# Figure out which vars are numeric vs. factor#
		vars.num <- vector()#
		for(v in predictors.all){#
			if(class(data[,v]) %in% c("numeric", "integer")) vars.num <- c(vars.num, v)#
		}#
		# Getting the unique values of our factor variables and adding them to the data frame#
		# need to skip group & group.cc so we aren't trying to match Carya & Quercus etc#
		predictors.all <- predictors.all[!predictors.all %in% c("Species", "spp.plot")]#
		for(v in predictors.all[!predictors.all %in% vars.num & !(predictors.all %in% c("group", "group.cc"))]){#
			# if v is a factor, merge all unique values into the dataframe#
			var.temp <- data.frame(x=unique(data[,v])) #
			names(var.temp) <- v#
			new.dat <- merge(new.dat, var.temp, all.x=T, all.y=T)#
		}#
		# getting species from species.plot#
		new.dat$group <- as.factor(substr(new.dat$group.plot, 1, 4))#
		# Adding in the group.canopy class then getting rid of combinations we don't actually have in our data#
		new.dat$group.cc <- as.factor(paste(new.dat$group, new.dat$Canopy.Class, sep="."))#
		new.dat <- new.dat[new.dat$group.cc %in% unique(test$group.cc),]#
		summary(new.dat)#
		# Putting the numerical variables into an array and adding it in #
		var.temp <- data.frame(array(dim=c(n.out, length(vars.num))))#
		names(var.temp) <- vars.num#
		for(v in vars.num){#
			var.temp[,v] <- seq(min(data[,v], na.rm=T), max(data[,v], na.rm=T), length.out=n.out)#
		}								#
		new.dat <- merge(new.dat, var.temp, all.x=T, all.y=T)#
		summary(new.dat)#
write.csv(new.dat, file="processed_data/sensitivity_extaction_dataframe.csv", row.names=F)
source("0_Calculate_GAMM_Posteriors.R")#
		g2.ci.terms.pred2 <- post.distns(model.gam=gam2, model.name="harv_mmf_cc.test", n=n, newdata=new.dat, vars=predictors.all, terms=T)#
		g2.ci.out2 <- g2.ci.terms.pred2$ci # separting out the confidence interval #
		g2.ci.out2[,predictors.all[!predictors.all %in% vars.num]] <- new.dat[,predictors.all[!predictors.all %in% vars.num]] # copying over our factor labels#
		g2.ci.out2$x <- as.numeric(g2.ci.out2$x) # making x numeric; will make factors NA#
		summary(g2.ci.out2)#
		g2.ci.out2[,c("mean.bai", "lwr.bai", "upr.bai")] <- exp(g2.ci.out2[,c("mean", "lwr", "upr")])
# Truncating to observed range#
# DBH		#
for(s in unique(test$Canopy.Class)){#
	dbh.min <- min(test[test$Canopy.Class==s, "dbh.recon"])#
	dbh.max <- max(test[test$Canopy.Class==s, "dbh.recon"])#
	g2.ci.out2$x <- ifelse(g2.ci.out2$Canopy.Class!=s | g2.ci.out2$Effect!="dbh.recon" | (g2.ci.out2$x>=dbh.min & g2.ci.out2$x<=dbh.max), g2.ci.out2$x, NA)#
	}#
#
# Temp#
for(s in unique(test$Canopy.Class)){#
	temp.min <- min(test[test$Canopy.Class==s, "tmean"])#
	temp.max <- max(test[test$Canopy.Class==s, "tmean"])#
		g2.ci.out2$x <- ifelse(g2.ci.out2$Canopy.Class!=s | g2.ci.out2$Effect!="tmean" | (g2.ci.out2$x>=temp.min & g2.ci.out2$x<=temp.max), g2.ci.out2$x, NA)#
	}#
# Precip	#
for(s in unique(test$Canopy.Class)){#
	precip.min <- min(test[test$Canopy.Class==s, "precip"])#
	precip.max <- max(test[test$Canopy.Class==s, "precip"])#
		g2.ci.out2$x <- ifelse(g2.ci.out2$Canopy.Class!=s | g2.ci.out2$Effect!="precip" | (g2.ci.out2$x>=precip.min & g2.ci.out2$x<=precip.max), g2.ci.out2$x, NA)#
	}
ggplot(data=g2.ci.out2[g2.ci.out2$Effect %in% c("tmean", "precip", "dbh.recon"), ]) + #
  facet_wrap(~Effect, scales="free_x") +#
  geom_line(aes(x=x, y=0), linetype="dashed")+#
  geom_ribbon(aes(x=x, ymin=lwr.bai, ymax=upr.bai, fill=Canopy.Class), alpha=0.5) +#
  geom_line(aes(x=x, y=mean.bai, color=Canopy.Class))+#
  scale_color_manual(values=c("#0072B2", "#009E73", "#E69F00")) +#
  scale_fill_manual(values=c("#0072B2", "#009E73",  "#E69F00")) +#
  theme_bw()+#
  labs(x = "Climate Variable", y = expression(bold(paste("Effect on BAI (mm"^"2","y"^"-1",")"))))+#
  theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
  ylim(0,2.5)
pdf("figures/Prelim_Figures/gam2_sensitivities.pdf", width= 13, height = 8.5)		#
ggplot(data=g2.ci.out2[g2.ci.out2$Effect %in% c("tmean", "precip", "dbh.recon"), ]) + #
  facet_wrap(~Effect, scales="free_x") +#
  geom_line(aes(x=x, y=0), linetype="dashed")+#
  geom_ribbon(aes(x=x, ymin=lwr.bai, ymax=upr.bai, fill=Canopy.Class), alpha=0.5) +#
  geom_line(aes(x=x, y=mean.bai, color=Canopy.Class))+#
  scale_color_manual(values=c("#0072B2", "#009E73", "#E69F00")) +#
  scale_fill_manual(values=c("#0072B2", "#009E73",  "#E69F00")) +#
  theme_bw()+#
  labs(x = "Climate Variable", y = expression(bold(paste("Effect on BAI (mm"^"2","y"^"-1",")"))))+#
  theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
  ylim(0,2.5)#
dev.off()
g2.ci.out2$PlotID <- as.factor(substr(g2.ci.out2$group.plot, 6, nchar(paste(g2.ci.out2$group.plot)))) # adding a plotID factor#
		summary(g2.ci.out2)
source("0_Calculate_GAMM_Posteriors.R")
n <- 100#
model.pred <- post.distns(model.gam=gam2, model.name="canopy_response", newdata=test, vars=predictors.all, n=n, terms=F)#
summary(model.pred$ci)
# Need help dealing with the list that is set up here.  Need help with the aggregation#
model.pred2 <- model.pred$ci#
summary(model.pred2)#
dim(model.pred2)#
#
# Change predicted CI to BAI units#
model.pred2[,c("mean.bai", "lwr.bai", "upr.bai")] <- exp(model.pred2[,c("mean", "lwr", "upr")])#
summary(model.pred2)
# Aggregating to the group level in teh same way we do below with the ring widths#
# We can then compare our modeled RW to our measured RW and see how things look#
# Sanity Check #1#
#
mean.model <- aggregate(model.pred2$mean, by = model.pred2[, c("Canopy.Class", "Site", "Year")], FUN=mean, na.rm=T)#
names(mean.model)[names(mean.model)=="x"] <- c("BAI.mean") #
mean.model[,"BAI.lwr"] <- aggregate(model.pred2$mean, by=model.pred2[,c("Canopy.Class", "Site", "Year")], FUN=quantile, probs=0.025, na.rm=T)[,"x"]#
mean.model[,"BAI.upr"] <- aggregate(model.pred2$mean, by=model.pred2[,c("Canopy.Class", "Site", "Year")], FUN=quantile, probs=0.975, na.rm=T)[,"x"]#
head(mean.model)#
#
mean.modelB <- aggregate(model.pred2$mean.bai, by = model.pred2[, c("Site", "Year")], FUN=mean, na.rm=T)#
names(mean.modelB)[names(mean.modelB)=="x"] <- c("BAI.mean") #
mean.modelB[,"BAI.lwr"] <- aggregate(model.pred2$mean.bai, by=model.pred2[,c("Site", "Year")], FUN=quantile, probs=0.025, na.rm=T)[,"x"]#
mean.modelB[,"BAI.upr"] <- aggregate(model.pred2$mean.bai, by=model.pred2[,c("Site", "Year")], FUN=quantile, probs=0.975, na.rm=T)[,"x"]#
head(mean.modelB)#
#
# creating a group.cc variable for test#
test$group.cc <- as.factor(paste(test$group, test$Canopy.Class, sep="."))#
#
# aggregating the raw data for graphing#
mean.rw <- aggregate(test$BA.inc, by=test[, c("Canopy.Class", "Site", "Year")], FUN=mean, na.rm=T)#
names(mean.rw)[names(mean.rw)=="x"]<- c("BAI.mean")                  #
# mean.rw[,"rw.lwr"] <- aggregate(test$RW, by=test[,c("group", "Site", "Year")], FUN=quantile, probs=0.025, na.rm=T)[,"x"]#
# mean.rw[,"rw.upr"] <- aggregate(test$RW, by=test[,c("group", "Site", "Year")], FUN=quantile, probs=0.975, na.rm=T)[,"x"]#
# mean.rw[,"BAI.mean"] <- aggregate(test$BA.inc, by=test[,c("group", "Site", "Year")], FUN=mean, na.rm=T)[,"x"]#
mean.rw[,"BAI.lwr"] <- aggregate(test$BA.inc, by=test[,c("Canopy.Class", "Site", "Year")], FUN=quantile, probs=0.025, na.rm=T)[,"x"]#
mean.rw[,"BAI.upr"] <- aggregate(test$BA.inc, by=test[,c("Canopy.Class", "Site", "Year")], FUN=quantile, probs=0.975, na.rm=T)[,"x"]#
head(mean.rw)#
#
mean.rw <- mean.rw[mean.rw$Site %in% sites.use,]#
#
#mean.rw$Species <- mean.rw$group#
#
# Setting up lm between the modeled values and the observed	#
dim(mean.rw)#
dim(mean.model)
# mean.rw <- mean.rw[mean.rw$group %in% mean.model$group,]#
# mean.rw <- mean.rw[mean.rw$Year %in% mean.model$Year,]#
#
summary(mean.rw); #
summary(mean.model)#
#
mean.model2 <- mean.model#
names(mean.model2)[4:6] <- c("mod.mean", "mod.lwr", "mod.up")#
#
summary(mean.model2)#
#
sanity.gam2.df <- merge(mean.model2, mean.rw, all.x=T, all.y=T)#
summary(sanity.gam2.df)#
#
sanity.gam2.df$log.BAI <- log(sanity.gam2.df$BAI.mean)#
summary(sanity.gam2.df[is.na(sanity.gam2.df$mod.mean),])#
head(sanity.gam2.df[is.na(sanity.gam2.df$mod.mean),])#
#
# LM on aggregated BAI#
sanity.lm2 <- lm(mod.mean ~ log.BAI, data=sanity.gam2.df)#
gam2.resid <- resid(sanity.lm2)#
summary(sanity.lm2)#
#
plot(sanity.gam2.df$log.BAI ~ gam2.resid, xlab="Log BAI", ylab="Residuals", main="Gam2 Residuals", ylim=c(-4,4))#
abline(0,0)
ggplot(data=mean.rw) + facet_wrap(Canopy.Class ~ Site, scales="fixed") + theme_bw() +#
	# plot the data#
	geom_ribbon(aes(x=Year, ymin=BAI.lwr, ymax=BAI.upr), alpha=0.5) +#
	geom_line(aes(x=Year, y=BAI.mean), size=1) +#
	# Plot our model#
	geom_ribbon(data=mean.model, aes(x=Year, ymin=exp(BAI.lwr), ymax=exp(BAI.upr)), fill="red3", alpha=0.3) +#
	geom_line(data=mean.model, aes(x=Year, y=exp(BAI.mean)), color="red3", alpha=0.8, size=1) +#
	labs(title="Gamm Model vs. Data", x="Year", y="BAI")
pdf("figures/gam_sanity_check/gam2_sanitycheck1.pdf", width= 13, height = 8.5)#
ggplot(data=mean.rw) + facet_wrap(Canopy.Class ~ Site, scales="fixed") + theme_bw() +#
	# plot the data#
	geom_ribbon(aes(x=Year, ymin=BAI.lwr, ymax=BAI.upr), alpha=0.5) +#
	geom_line(aes(x=Year, y=BAI.mean), size=1) +#
	# Plot our model#
	geom_ribbon(data=mean.model, aes(x=Year, ymin=exp(BAI.lwr), ymax=exp(BAI.upr)), fill="red3", alpha=0.3) +#
	geom_line(data=mean.model, aes(x=Year, y=exp(BAI.mean)), color="red3", alpha=0.8, size=1) +#
	labs(title="Gamm Model vs. Data", x="Year", y="BAI")#
dev.off()
# Sanity Check #2#
# Pulling random trees from both the data.use and the model.pred2 to see how they compare#
#
n <- 20#
data.use2 <- data.use[data.use$Site %in% sites.use,]#
data.use2 <- data.use2[data.use2$group %in% group.use,]#
#
sanity2.trees <- sample(st$TreeID, size=n, replace=F) #
summary(sanity2.trees)#
#
summary(mean.rw)#
summary(data.use)#
summary(model.pred2)#
#
# Sanity Check #2 graph#
pdf("figures/gam_sanity_check/gam2_sanitycheck2.pdf", width= 13, height = 8.5)#
ggplot(data=test[test$TreeID %in% sanity2.trees,]) + facet_wrap(TreeID~ Site, scales="fixed") + theme_bw() +#
	# plot the data#
	#geom_ribbon(aes(x=Year, ymin=rw.lwr, ymax=rw.upr), alpha=0.5) +#
	geom_line(aes(x=Year, y=BA.inc), size=1) +#
	# Plot our model#
	#geom_ribbon(data=model.pred2[model.pred2$TreeID %in% sanity2.trees,], aes(x=Year, ymin=rw.lwr, ymax=rw.upr), fill="red3", alpha=0.3) +#
	geom_line(data=model.pred2[model.pred2$TreeID %in% sanity2.trees,], aes(x=Year, y=exp(mean)), color="red3", alpha=0.8, size=1) +#
	geom_hline(yintercept=0, linetype="dashed")+#
	labs(title="Gamm Model vs. Data Indiv. Trees", x="Year", y="BAI")#
dev.off()#
# lm2 for sanity check 2#
summary(model.pred2)#
summary(data.use)#
summary(test)#
#
model.pred2$RW <- test$RW#
model.pred2$BAI <- test$BA.inc#
#
# LM for indiv. trees#
sanity.lm2 <- lm(BAI ~ mean, data=model.pred2)#
summary(sanity.lm2)#
#
# sanity.lm2.quru <- lm(RW ~ mean, data=model.pred2[model.pred2$group=="quru",])#
# summary(sanity.lm2)#
# running scripts to get the weights#
source("0_Calculate_GAMM_Weights.R")#
# test2 <- test[test$group %in% c("QURU", "ACRU") & test$Year>=1980,]#
# test2 <- test[test$group %in% c("QURU") & test$Year>=1980,]#
# summary(test2)#
# gam1.test <- gamm(RW ~ s(tmean, k=3, by=group) + # tmean*Species #
#                   s(precip, k=3, by=group) +#
#                   s(dbh.recon, k=3, by=group.plot) +#
#                   Canopy.Class, #
#                   random=list(Site=~1, PlotID=~1),#
#                   data=test2)#
#
predictors.all#
# vars <- c("tmean", "precip", "dbh.recon", "Canopy.Class", "group.plot", "group", "group.cc")#
vars <- c("tmean", "precip", "dbh.recon")#
gam2.weights <- factor.weights(model.gam = gam2, model.name = "species_response", newdata = test, extent = "", vars = vars, limiting=T)#
#
summary(gam2.weights)#
summary(test)#
gam2.weights[,c("BA.inc", "group", "Canopy.Class")] <- test[,c("BA.inc", "group", "Canopy.Class")] # Adding in factors we forgot#
#
gam2.weights[,c("fit.full.bai", "tmean.bai", "precip.bai", "dbh.bai")] <- exp(gam2.weights[,c("fit.full", "fit.tmean", "fit.precip", "fit.dbh.recon")])#
summary(gam2.weights)#
#
# Just the weights of tmean and Precip, ignoring size#
vars2 <- c("tmean.bai", "precip.bai")#
fit.spline2 <- rowSums(abs(gam2.weights[,vars2]), na.rm=T)#
for(v in vars2){#
	gam2.weights[,paste("weight", v, "2", sep=".")] <- gam2.weights[,v]/fit.spline2#
}#
summary(gam2.weights)#
#
cols.weights <- c("weight.tmean.bai.2", "weight.precip.bai.2")#
for(i in 1:nrow(gam2.weights)){#
	fweight <- abs(gam2.weights[i,cols.weights])#
	gam2.weights[i,"max2"] <- max(fweight, na.rm=T)#
	gam2.weights[i,"factor.max2"] <- c("tmean", "precip")[which(fweight==max(fweight))]#
}#
gam2.weights$factor.max2 <- as.factor(gam2.weights$factor.max2)#
summary(gam2.weights)#
#
save(gam2.weights, file="processed_data/gamm_weights/gam2_weights.Rdata")
library(ggplot2)#
require(car)#
#
load(file="processed_data/gamm_weights/gam2_weights.Rdata")#
#
summary(gam2.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] <- exp(gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] )
othervars <- c("Year", "Site", "Canopy.Class", "Model")#
#
data.graph1 <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam2.weights[gam2.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam2.weights$wts.check <- rowSums(abs(gam2.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam2.weights)#
summary(data.graph)
load("processed_data/climate_markeryears.Rdata")#
summary(climate.markers)#
climate.markers$State <- recode(climate.markers$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")
pdf("figures/Prelim_Figures/bai_climatemarkers_canopy.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Canopy temp years")#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Canopy precip years")#
# Morgan Monroe#
#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Canopy temp years")#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Canopy precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Oak Openings Canopy temp years")#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Oak Openings Canopy precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x ="Harvard Canopy temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Canopy precip years")#
# Howland#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Howland Canopy temp years")#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="HowlandCanopy precip years")#
dev.off()
load("processed_data/climate_markeryears.Rdata")#
summary(climate.markers)#
climate.markers$State <- recode(climate.markers$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$Canopy.Class, data.graph$Site, decreasing=F),]#
plot.rgb <- function(STATE, CC, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.precip"   ]))) }   # blue#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))
pdf("figures/Prelim_Figures/bai_climatemarkers_canopy.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Canopy temp years")#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Canopy precip years")#
# Morgan Monroe#
#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Canopy temp years")#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Canopy precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Oak Openings Canopy temp years")#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Oak Openings Canopy precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x ="Harvard Canopy temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Canopy precip years")#
# Howland#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Howland Canopy temp years")#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="HowlandCanopy precip years")#
dev.off()
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1900,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x ="Harvard Canopy temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1900,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Canopy precip years")
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1900,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x ="Harvard Canopy temp years")
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1900,2015)
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1900,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Canopy temp years")
pdf("figures/Prelim_Figures/bai_climatemarkers_canopy.pdf", width= 13, height = 8.5)#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1900,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Canopy temp years")#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1900,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Canopy precip years")#
# Morgan Monroe#
#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1900,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Canopy temp years")#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1900,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Canopy precip years")#
# Oak Openings#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1900,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Oak Openings Canopy temp years")#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1900,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Oak Openings Canopy precip years")#
#
# Harvard#
#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1900,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Canopy temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1900,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Canopy precip years")#
# Howland#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
  	xlim(1900,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Howland Canopy temp years")#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(Canopy.Class~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1900,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="HowlandCanopy precip years")#
dev.off()
library(ggplot2)#
require(car)#
#
load(file="processed_data/gamm_weights/gam2_weights.Rdata")#
#
summary(gam2.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] <- exp(gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] )#
othervars <- c("Year", "Site", "Canopy.Class", "Model")#
#
data.graph1 <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam2.weights[gam2.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam2.weights$wts.check <- rowSums(abs(gam2.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam2.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$Canopy.Class, data.graph$Site, decreasing=F),]
plot.rgb <- function(STATE, CC, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.precip"   ]))) }   # blue
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))
load("processed_data/climate_markeryears.Rdata")#
summary(climate.markers)#
climate.markers$State <- recode(climate.markers$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")
library(ggplot2)#
library(car)#
load(file="processed_data/gamm_weights/gam1_weights.Rdata")#
#
summary(gam1.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam1.weights[,which(substr(names(gam1.weights),1,3)=="fit")] <- exp(gam1.weights[,which(substr(names(gam1.weights),1,3)=="fit")] )#
#
othervars <- c("Year", "Site", "group", "Model")#
#
data.graph1 <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam1.weights[gam1.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam1.weights$wts.check <- rowSums(abs(gam1.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam1.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$group, data.graph$Site, decreasing=F),]#
summary(data.graph)#
#
plot.rgb <- function(STATE, SPP, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$group==SPP,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.precip"   ]))) }   # blue#
#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))#
#
summary(data.graph[!data.graph$group %in% c("BETULA", "CARYA", "FAGR", "FRAX", "SAAL"),])
load("processed_data/climate_markeryears.Rdata")#
summary(climate.markers)#
climate.markers$State <- recode(climate.markers$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")
pdf("figures/Prelim_Figures/bai_climatemarkers_SPP.pdf", width= 13, height = 8.5)#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Missouri Spp temp years")#
ggplot(data.graph[data.graph$State=="MO",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MO" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Missouri Spp precip years")#
# Morgan Monroe#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="MMF Spp temp years")#
ggplot(data.graph[data.graph$State=="IN",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="IN" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="MMF Spp precip years")#
# Oak Openings#
#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1920,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Oak Openings Spp temp years")#
ggplot(data.graph[data.graph$State=="OH",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="OH" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1920,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Oak Openings Spp precip years")#
# Harvard#
#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1900,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Harvard Spp temp years")#
ggplot(data.graph[data.graph$State=="MA",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="MA" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1900,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Harvard Spp precip years")#
# Howland#
#
# Missouri Ozark#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(group~., scales="free") + #
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue", "dodgerblue", "brown"))+#
  	xlim(1900,2015)+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) +labs(title="Howland Spp temp years")#
ggplot(data.graph[data.graph$State=="ME",]) + facet_grid(group~., scales="free") +#
	scale_x_continuous(expand=c(0,0), name="Year") +#
  	scale_y_continuous(expand=c(0,0), name="BAI") +#
  	# facet_wrap(~TreeID, scales="free_y", space="free") +#
  	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  	geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  	geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)+#
  	geom_vline(data=climate.markers[climate.markers$State=="ME" & climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	xlim(1900,2015)+#
  	scale_color_manual(values=c("dodgerblue", "brown"))+#
  	theme(axis.line=element_line(color="black"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), panel.background=element_blank(),axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5)) + labs(title="Howland Spp precip years")#
dev.off()
library(mgcv)#
library(ggplot2)#
library(car)#
# Christy's GAMM code#
#
# gam1 <- gamm(Y ~  s(Biomass, bs="cr", k=3, by=PFT) + s(tair, k=k, by=PFT) + s(precipf, k=k, by=PFT) + s(CO2, k=k, by=PFT), random=list(PlotID=~1), data=data) #
#
# Loading in my data#
#
data.use <- read.csv("processed_data/AllSites_tree_plus_climate_and_BA.csv", header=T)#
#
data.use$group <- data.use$Species#
data.use$group <- recode(data.use$group, "'CAOV' = 'CARYA'; 'CACO' = 'CARYA'; #
  							'CATE' = 'CARYA'; 'ACSAC' = 'ACSA'; 'BEAL' = 'BETULA'; 'BELE' = 'BETULA'; 'QUMU' = 'QUAL'")#
#
data.use$group.plot <- as.factor(paste(data.use$group, data.use$PlotID, sep="."))#
#
data.use$Canopy.Class <- recode(data.use$Canopy.Class, "'C' = 'D'")#
summary(data.use)#
# reducing the amount of data for the test runs#
sites.use <- c("Harvard", "Howland", "Morgan Monroe State Park", "Oak Openings Toledo", "Missouri Ozark")#
#
test <- data.use[data.use$Site %in% sites.use & !is.na(data.use$RW) & !is.na(data.use$BA.inc),]#
summary(test)#
#
test$group.cc <- as.factor(paste(test$group, test$Canopy.Class, sep="."))#
summary(test)#
# Get a list of what predictors & responses I'm using#
predictors.all <- c("tmean", "precip", "Species", "dbh.recon", "Canopy.Class", "spp.plot", "group", "group.plot", "group.cc", "Site") #
#
# Getting rid of observations that have NAs in the important variables#
test <- test[complete.cases(test[,predictors.all]),]#
test <- test[test$Live.Dead=="LIVE" & !test$Canopy.Class=="F",]#
#
# Subsetting to a set of species that we have enough data to feel good about#
#species.use <- c("TSCA", "QURU", "ACRU", "BEAL", "ACSA", "LITU", "QUAL", "CAOV", "CACO", "CATE", "JUVI", "QUVE", "PCRU", "THOC", "PIST")#
group.use <- c("ACRU", "ACSA", "BETULA", "CARYA", "FAGR", "FRAX", "PIST", "QUAL", "QURU", "QUVE", "SAAL", "TSCA", "ULRU")#
#
test <- test[test$group %in% group.use,]#
#
summary(test)#
#
par(new=F)#
plot(test[test$TreeID=="MMA003", "BA.inc"]~ test[test$TreeID=="MMA003","Year"], type="l")#
test$log.dbh <- log(test$dbh.recon)#
summary(test)#
#
summary(test)#
summary(test$Live.Dead)#
summary(test$Canopy.Class)#
# RW <- test$RW#
# temp <- test$tmean#
# precip <- test$precip#
# canopy <- test$Canopy.Class#
# size <- test$DBH..cm.#
# species <- unique(test$Species)#
# library(ggplot2)#
# ggplot(data=test) +#
   # facet_wrap(~PlotID) +#
   # geom_histogram(aes(x=dbh.recon))#
# ggplot(data=test) +#
   # facet_wrap(~Species) +#
   # geom_histogram(aes(x=dbh.recon))#
# hist(test$dbh.recon)#
# test2 <- test[test$group %in% c("QURU", "ACRU") & test$Year>=1980,]#
# test2 <- test[test$group %in% c("QURU", "ACRU"),]#
test2 <- test[test$Site %in% c("Morgan Monroe State Park", "Harvard"), ]#
# test2$log.dbh <- log(test2$dbh.recon)#
# summary(test2)#
summary(test)#
test[test$BA.inc==0, "BA.inc"] <- 1e-6#
save(test, file="ch2_combined_data_use.Rdata")#
# test.gam3 <- test#
# test.gam3$Canopy.Class <- recode(test.gam3$Canopy.Class, "'C' = 'D'")#
# summary(test.gam3)
load("processed_data/gam_results/gam1_climate_by_species.Rdata")
# Change which gamm you look at here!#
n <- 100						#
		# SOurce & run the function#
		source("0_Calculate_GAMM_Posteriors.R")#
		g1.ci.terms.pred <- post.distns(model.gam=gam1, model.name="species_response", n=n, newdata=new.dat, vars=predictors.all, terms=T)#
		g1.ci.out <- g1.ci.terms.pred$ci # separting out the confidence interval #
		g1.ci.out[,predictors.all[!predictors.all %in% vars.num]] <- new.dat[,predictors.all[!predictors.all %in% vars.num]] # copying over our factor labels#
		g1.ci.out$x <- as.numeric(g1.ci.out$x) # making x numeric; will make factors NA#
		summary(g1.ci.out)#
		g1.ci.out[,c("mean.bai", "lwr.bai", "upr.bai")] <- exp(g1.ci.out[,c("mean", "lwr", "upr")])#
spp.colors <- read.csv("spp.Colors.csv", header=T)	#
summary(spp.colors)	#
#
group.fig <- unique(g1.ci.out$group)#
group.fig <- group.fig[order(group.fig)]#
colors.use <- as.vector(c(paste(spp.colors[spp.colors$Species %in% group.fig, "color"])))#
#
ci.terms.graph <- g1.ci.out#
ci.terms.graph[ci.terms.graph$mean<(-3),"mean"] <- NA #
ci.terms.graph[ci.terms.graph$lwr<(-3),"lwr"] <- -3#
ci.terms.graph[ci.terms.graph$upr<(-3),"upr"] <- -3 #
ci.terms.graph[which(ci.terms.graph$mean>3),"mean"] <- NA #
ci.terms.graph[ci.terms.graph$lwr>(3),"lwr"] <- 3#
ci.terms.graph[ci.terms.graph$upr>(3),"upr"] <- 3
n <- 100#
data <- test#
		n.out = n#
#
		new.dat <- data.frame(Model="species_response",#
							  Extent=as.factor(paste(min(data$Year), max(data$Year), sep="-")))#
		# Figure out which vars are numeric vs. factor#
		vars.num <- vector()#
		for(v in predictors.all){#
			if(class(data[,v]) %in% c("numeric", "integer")) vars.num <- c(vars.num, v)#
		}#
		# Getting the unique values of our factor variables and adding them to the data frame#
		# need to skip group & group.cc so we aren't trying to match Carya & Quercus etc#
		predictors.all <- predictors.all[!predictors.all %in% c("Species", "spp.plot")]#
		for(v in predictors.all[!predictors.all %in% vars.num & !(predictors.all %in% c("group", "group.cc"))]){#
			# if v is a factor, merge all unique values into the dataframe#
			var.temp <- data.frame(x=unique(data[,v])) #
			names(var.temp) <- v#
			new.dat <- merge(new.dat, var.temp, all.x=T, all.y=T)#
		}#
		# getting species from species.plot#
		new.dat$group <- as.factor(substr(new.dat$group.plot, 1, 4))#
		# Adding in the group.canopy class then getting rid of combinations we don't actually have in our data#
		new.dat$group.cc <- as.factor(paste(new.dat$group, new.dat$Canopy.Class, sep="."))#
		new.dat <- new.dat[new.dat$group.cc %in% unique(test$group.cc),]#
		summary(new.dat)#
		# Putting the numerical variables into an array and adding it in #
		var.temp <- data.frame(array(dim=c(n.out, length(vars.num))))#
		names(var.temp) <- vars.num#
		for(v in vars.num){#
			var.temp[,v] <- seq(min(data[,v], na.rm=T), max(data[,v], na.rm=T), length.out=n.out)#
		}								#
		new.dat <- merge(new.dat, var.temp, all.x=T, all.y=T)#
		summary(new.dat)#
write.csv(new.dat, file="processed_data/sensitivity_extaction_dataframe.csv", row.names=F)								#
# Change which gamm you look at here!#
n <- 100						#
		# SOurce & run the function#
		source("0_Calculate_GAMM_Posteriors.R")#
		g1.ci.terms.pred <- post.distns(model.gam=gam1, model.name="species_response", n=n, newdata=new.dat, vars=predictors.all, terms=T)#
		g1.ci.out <- g1.ci.terms.pred$ci # separting out the confidence interval #
		g1.ci.out[,predictors.all[!predictors.all %in% vars.num]] <- new.dat[,predictors.all[!predictors.all %in% vars.num]] # copying over our factor labels#
		g1.ci.out$x <- as.numeric(g1.ci.out$x) # making x numeric; will make factors NA#
		summary(g1.ci.out)#
		g1.ci.out[,c("mean.bai", "lwr.bai", "upr.bai")] <- exp(g1.ci.out[,c("mean", "lwr", "upr")])#
spp.colors <- read.csv("spp.Colors.csv", header=T)	#
summary(spp.colors)	#
#
group.fig <- unique(g1.ci.out$group)#
group.fig <- group.fig[order(group.fig)]#
colors.use <- as.vector(c(paste(spp.colors[spp.colors$Species %in% group.fig, "color"])))#
#
ci.terms.graph <- g1.ci.out#
ci.terms.graph[ci.terms.graph$mean<(-3),"mean"] <- NA #
ci.terms.graph[ci.terms.graph$lwr<(-3),"lwr"] <- -3#
ci.terms.graph[ci.terms.graph$upr<(-3),"upr"] <- -3 #
ci.terms.graph[which(ci.terms.graph$mean>3),"mean"] <- NA #
ci.terms.graph[ci.terms.graph$lwr>(3),"lwr"] <- 3#
ci.terms.graph[ci.terms.graph$upr>(3),"upr"] <- 3
spp.colors
group.fig
g1.ci.out$group
summary(g1.ci.out)
unique(gi.ci.out$group)
unique(g1.ci.out$group)
# Truncating to observed range#
# DBH		#
for(s in unique(test$group)){#
	dbh.min <- min(test[test$group==s, "dbh.recon"])#
	dbh.max <- max(test[test$group==s, "dbh.recon"])#
	ci.terms.graph$x <- ifelse(ci.terms.graph$group!=s | ci.terms.graph$Effect!="dbh.recon" | (ci.terms.graph$x>=dbh.min & ci.terms.graph$x<=dbh.max), ci.terms.graph$x, NA)#
	}#
#
# Temp#
for(s in unique(test$group)){#
	temp.min <- min(test[test$group==s, "tmean"])#
	temp.max <- max(test[test$group==s, "tmean"])#
		ci.terms.graph$x <- ifelse(ci.terms.graph$group!=s | ci.terms.graph$Effect!="tmean" | (ci.terms.graph$x>=temp.min & ci.terms.graph$x<=temp.max), ci.terms.graph$x, NA)#
	}#
# Precip	#
for(s in unique(test$group)){#
	precip.min <- min(test[test$group==s, "precip"])#
	precip.max <- max(test[test$group==s, "precip"])#
		ci.terms.graph$x <- ifelse(ci.terms.graph$group!=s | ci.terms.graph$Effect!="precip" | (ci.terms.graph$x>=precip.min & ci.terms.graph$x<=precip.max), ci.terms.graph$x, NA)#
	}
ggplot(data=ci.terms.graph[ci.terms.graph$Effect %in% c("tmean"), ]) + #
			facet_wrap(group~Effect) +#
			geom_line(aes(x=x, y=0), linetype="dotted")+#
			geom_ribbon(aes(x=x, ymin=exp(lwr), ymax=exp(upr), fill=group), alpha=0.5) +#
			geom_line(aes(x=x, y=exp(mean), color=group)) +#
			scale_color_manual(values=colors.use) +#
			scale_fill_manual(values=colors.use)+#
			theme_bw()+#
			labs(x = "Climate Variable", y = expression(bold(paste("Effect on BAI (mm"^"2", 							"y"^"-1",")")))) +#
			ylim(-1,3)
spp.colors[spp.colors$Species %in% group.fig, "color"]
spp.colors[spp.colors$Species %in% group.fig,]
predictors.all
summary(gam1)
summary(gam1$gam)
summary(newdat)
summary(new.dat)
unique(new.dat$group)
summary(predictors.all)
(predictors.all)
vars.num
data
summary(data)
unique(data$group)
new.dat$group
summary(new.dat$group)
summary(gam1$gam)
predictors.all
summary(gam1)
summary(gam1)$gam
data <- test
n.out = n#
#
		new.dat <- data.frame(Model="species_response",#
							  Extent=as.factor(paste(min(data$Year), max(data$Year), sep="-")))#
		# Figure out which vars are numeric vs. factor#
		vars.num <- vector()#
		for(v in predictors.all){#
			if(class(data[,v]) %in% c("numeric", "integer")) vars.num <- c(vars.num, v)#
		}
# Getting the unique values of our factor variables and adding them to the data frame#
		# need to skip group & group.cc so we aren't trying to match Carya & Quercus etc#
		predictors.all <- predictors.all[!predictors.all %in% c("Species", "spp.plot")]#
		for(v in predictors.all[!predictors.all %in% vars.num & !(predictors.all %in% c("group", "group.cc"))]){#
			# if v is a factor, merge all unique values into the dataframe#
			var.temp <- data.frame(x=unique(data[,v])) #
			names(var.temp) <- v#
			new.dat <- merge(new.dat, var.temp, all.x=T, all.y=T)#
		}
summary(new.dat)
new.dat$group <- as.factor(substr(new.dat$group.plot, 1, 4))
summary(new.dat)
summary(new.dat$group)
new.dat$group.cc <- as.factor(paste(new.dat$group, new.dat$Canopy.Class, sep="."))#
		new.dat <- new.dat[new.dat$group.cc %in% unique(test$group.cc),]#
		summary(new.dat)
# Putting the numerical variables into an array and adding it in #
		var.temp <- data.frame(array(dim=c(n.out, length(vars.num))))#
		names(var.temp) <- vars.num#
		for(v in vars.num){#
			var.temp[,v] <- seq(min(data[,v], na.rm=T), max(data[,v], na.rm=T), length.out=n.out)#
		}								#
		new.dat <- merge(new.dat, var.temp, all.x=T, all.y=T)#
		summary(new.dat)
summary(new.dat$group)
unique(test$group.cc)
# getting species from species.plot#
		new.dat$group <- as.factor(ifelse(substr(new.dat$group.plot, 1, 4)=="BETU", "BETULA", ifelse(substr(new.dat$group.plot, 1,4)=="CARY", "CARYA", substr(new.dat$group.plot, 1, 4))))
new.dat <- data.frame(Model="species_response",#
							  Extent=as.factor(paste(min(data$Year), max(data$Year), sep="-")))#
		# Figure out which vars are numeric vs. factor#
		vars.num <- vector()#
		for(v in predictors.all){#
			if(class(data[,v]) %in% c("numeric", "integer")) vars.num <- c(vars.num, v)#
		}#
		# Getting the unique values of our factor variables and adding them to the data frame#
		# need to skip group & group.cc so we aren't trying to match Carya & Quercus etc#
		predictors.all <- predictors.all[!predictors.all %in% c("Species", "spp.plot")]#
		for(v in predictors.all[!predictors.all %in% vars.num & !(predictors.all %in% c("group", "group.cc"))]){#
			# if v is a factor, merge all unique values into the dataframe#
			var.temp <- data.frame(x=unique(data[,v])) #
			names(var.temp) <- v#
			new.dat <- merge(new.dat, var.temp, all.x=T, all.y=T)#
		}#
		# getting species from species.plot#
		new.dat$group <- as.factor(ifelse(substr(new.dat$group.plot, 1, 4)=="BETU", "BETULA", ifelse(substr(new.dat$group.plot, 1,4)=="CARY", "CARYA", substr(new.dat$group.plot, 1, 4))))
summary(new.dat$group)
new.dat$group.cc <- as.factor(paste(new.dat$group, new.dat$Canopy.Class, sep="."))
summary(new.dat$group)
new.dat <- new.dat[new.dat$group.cc %in% unique(test$group.cc),]
summary(new.dat$group)
# Gam1 graphs#
n <- 100#
data <- test#
		n.out = n#
#
		new.dat <- data.frame(Model="species_response",#
							  Extent=as.factor(paste(min(data$Year), max(data$Year), sep="-")))#
		# Figure out which vars are numeric vs. factor#
		vars.num <- vector()#
		for(v in predictors.all){#
			if(class(data[,v]) %in% c("numeric", "integer")) vars.num <- c(vars.num, v)#
		}#
		# Getting the unique values of our factor variables and adding them to the data frame#
		# need to skip group & group.cc so we aren't trying to match Carya & Quercus etc#
		predictors.all <- predictors.all[!predictors.all %in% c("Species", "spp.plot")]#
		for(v in predictors.all[!predictors.all %in% vars.num & !(predictors.all %in% c("group", "group.cc"))]){#
			# if v is a factor, merge all unique values into the dataframe#
			var.temp <- data.frame(x=unique(data[,v])) #
			names(var.temp) <- v#
			new.dat <- merge(new.dat, var.temp, all.x=T, all.y=T)#
		}#
		# getting species from species.plot#
		new.dat$group <- as.factor(ifelse(substr(new.dat$group.plot, 1, 4)=="BETU", "BETULA", ifelse(substr(new.dat$group.plot, 1,4)=="CARY", "CARYA", substr(new.dat$group.plot, 1, 4))))#
		# Adding in the group.canopy class then getting rid of combinations we don't actually have in our data#
		new.dat$group.cc <- as.factor(paste(new.dat$group, new.dat$Canopy.Class, sep="."))#
		new.dat <- new.dat[new.dat$group.cc %in% unique(test$group.cc),]#
		summary(new.dat)#
		# Putting the numerical variables into an array and adding it in #
		var.temp <- data.frame(array(dim=c(n.out, length(vars.num))))#
		names(var.temp) <- vars.num#
		for(v in vars.num){#
			var.temp[,v] <- seq(min(data[,v], na.rm=T), max(data[,v], na.rm=T), length.out=n.out)#
		}								#
		new.dat <- merge(new.dat, var.temp, all.x=T, all.y=T)#
		summary(new.dat)#
write.csv(new.dat, file="processed_data/sensitivity_extaction_dataframe.csv", row.names=F)
# Change which gamm you look at here!#
n <- 100						#
		# SOurce & run the function#
		source("0_Calculate_GAMM_Posteriors.R")#
		g1.ci.terms.pred <- post.distns(model.gam=gam1, model.name="species_response", n=n, newdata=new.dat, vars=predictors.all, terms=T)#
		g1.ci.out <- g1.ci.terms.pred$ci # separting out the confidence interval #
		g1.ci.out[,predictors.all[!predictors.all %in% vars.num]] <- new.dat[,predictors.all[!predictors.all %in% vars.num]] # copying over our factor labels#
		g1.ci.out$x <- as.numeric(g1.ci.out$x) # making x numeric; will make factors NA#
		summary(g1.ci.out)#
		g1.ci.out[,c("mean.bai", "lwr.bai", "upr.bai")] <- exp(g1.ci.out[,c("mean", "lwr", "upr")])#
spp.colors <- read.csv("spp.Colors.csv", header=T)	#
summary(spp.colors)	#
#
group.fig <- unique(g1.ci.out$group)#
group.fig <- group.fig[order(group.fig)]#
colors.use <- as.vector(c(paste(spp.colors[spp.colors$Species %in% group.fig, "color"])))#
#
ci.terms.graph <- g1.ci.out#
ci.terms.graph[ci.terms.graph$mean<(-3),"mean"] <- NA #
ci.terms.graph[ci.terms.graph$lwr<(-3),"lwr"] <- -3#
ci.terms.graph[ci.terms.graph$upr<(-3),"upr"] <- -3 #
ci.terms.graph[which(ci.terms.graph$mean>3),"mean"] <- NA #
ci.terms.graph[ci.terms.graph$lwr>(3),"lwr"] <- 3#
ci.terms.graph[ci.terms.graph$upr>(3),"upr"] <- 3 #
# Truncating to observed range#
# DBH		#
for(s in unique(test$group)){#
	dbh.min <- min(test[test$group==s, "dbh.recon"])#
	dbh.max <- max(test[test$group==s, "dbh.recon"])#
	ci.terms.graph$x <- ifelse(ci.terms.graph$group!=s | ci.terms.graph$Effect!="dbh.recon" | (ci.terms.graph$x>=dbh.min & ci.terms.graph$x<=dbh.max), ci.terms.graph$x, NA)#
	}#
#
# Temp#
for(s in unique(test$group)){#
	temp.min <- min(test[test$group==s, "tmean"])#
	temp.max <- max(test[test$group==s, "tmean"])#
		ci.terms.graph$x <- ifelse(ci.terms.graph$group!=s | ci.terms.graph$Effect!="tmean" | (ci.terms.graph$x>=temp.min & ci.terms.graph$x<=temp.max), ci.terms.graph$x, NA)#
	}#
# Precip	#
for(s in unique(test$group)){#
	precip.min <- min(test[test$group==s, "precip"])#
	precip.max <- max(test[test$group==s, "precip"])#
		ci.terms.graph$x <- ifelse(ci.terms.graph$group!=s | ci.terms.graph$Effect!="precip" | (ci.terms.graph$x>=precip.min & ci.terms.graph$x<=precip.max), ci.terms.graph$x, NA)#
	}
ggplot(data=ci.terms.graph[ci.terms.graph$Effect %in% c("tmean"), ]) + #
			facet_wrap(group~Effect) +#
			geom_line(aes(x=x, y=0), linetype="dotted")+#
			geom_ribbon(aes(x=x, ymin=exp(lwr), ymax=exp(upr), fill=group), alpha=0.5) +#
			geom_line(aes(x=x, y=exp(mean), color=group)) +#
			scale_color_manual(values=colors.use) +#
			scale_fill_manual(values=colors.use)+#
			theme_bw()+#
			labs(x = "Climate Variable", y = expression(bold(paste("Effect on BAI (mm"^"2", 							"y"^"-1",")")))) +#
			ylim(-1,3)
pdf("figures/prelim_figures/gam1_sensitivities_truncated_tmean.pdf", width= 13, height = 8.5)		#
		ggplot(data=ci.terms.graph[ci.terms.graph$Effect %in% c("tmean"), ]) + #
			facet_wrap(group~Effect) +#
			geom_line(aes(x=x, y=0), linetype="dotted")+#
			geom_ribbon(aes(x=x, ymin=exp(lwr), ymax=exp(upr), fill=group), alpha=0.5) +#
			geom_line(aes(x=x, y=exp(mean), color=group)) +#
			scale_color_manual(values=colors.use) +#
			scale_fill_manual(values=colors.use)+#
			theme_bw()+#
			labs(x = "Climate Variable", y = expression(bold(paste("Effect on BAI (mm"^"2", 							"y"^"-1",")")))) +#
			ylim(-1,3)#
dev.off()
pdf("figures/prelim_figures/gam1_sensitivities_truncated_precip.pdf", width= 13, height = 8.5)		#
		ggplot(data=ci.terms.graph[ci.terms.graph$Effect %in% c("precip"), ]) + #
			facet_wrap(group~Effect) +#
			geom_line(aes(x=x, y=0), linetype="dashed")+#
			geom_ribbon(aes(x=x, ymin=exp(lwr), ymax=exp(upr), fill=group), alpha=0.5) +#
			geom_line(aes(x=x, y=exp(mean), color=group)) +#
			scale_color_manual(values=colors.use) +#
			scale_fill_manual(values=colors.use)+#
			theme_bw()+#
			labs(x = "Climate Variable", y = expression(bold(paste("Effect on BAI (mm"^"2", 							"y"^"-1",")"))))+#
			ylim(-1,2)#
dev.off()#
#
pdf("figures/prelim_figures/gam1_sensitivities_truncated_size.pdf", width= 13, height = 8.5)		#
		ggplot(data=ci.terms.graph[ci.terms.graph$Effect %in% c("dbh.recon"), ]) + #
			facet_wrap(group~Effect) +#
			geom_line(aes(x=x, y=0), linetype="dashed")+#
			geom_ribbon(aes(x=x, ymin=exp(lwr), ymax=exp(upr), fill=group), alpha=0.5) +#
			geom_line(aes(x=x, y=exp(mean), color=group)) +#
			scale_color_manual(values=colors.use) +#
			scale_fill_manual(values=colors.use)+#
			theme_bw()+#
			labs(x = "Climate Variable", y = expression(bold(paste("Effect on BAI (mm"^"2", 							"y"^"-1",")"))))+#
			ylim(-1,10)#
dev.off()#
pdf("figures/prelim_figures/gam1_sensitivities_truncated_combo.pdf", width= 13, height = 8.5)		#
		ggplot(data=ci.terms.graph[ci.terms.graph$Effect %in% c("tmean", "precip", "dbh.recon"),]) + #
			facet_grid(group~Effect, scales="free_x") +#
			geom_line(aes(x=x, y=0), linetype="dashed")+#
			geom_ribbon(aes(x=x, ymin=lwr.bai, ymax=upr.bai, fill=group), alpha=0.5) +#
			geom_line(aes(x=x, y=mean.bai, color=group)) +#
			scale_color_manual(values=colors.use) +#
			scale_fill_manual(values=colors.use)+#
			theme_bw()+#
			labs(x = "Climate Variable", y = expression(bold(paste("Effect on BAI (mm"^"2","y"^"-1",")"))))+#
			 theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
        scale_x_continuous(expand=c(0,0)) + scale_y_continuous(expand=c(0,0))+#
        ylim(-1,10)#
dev.off()#
#
pdf("figures/prelim_figures/gam1_sensitivities_truncated_combo2.pdf", width= 13, height = 8.5)		#
		ggplot(data=ci.terms.graph[ci.terms.graph$Effect %in% c("tmean", "precip", "dbh.recon"),]) + #
			facet_grid(~Effect, scales = "free") +#
			geom_line(aes(x=x, y=0), linetype="dashed")+#
			geom_ribbon(aes(x=x, ymin=lwr.bai, ymax=upr.bai, fill=group), alpha=0.5) +#
			geom_line(aes(x=x, y=mean.bai, color=group)) +#
			scale_color_manual(values=colors.use) +#
			scale_fill_manual(values=colors.use)+#
			theme_bw()+#
			labs(x = "Climate Variable", y = expression(bold(paste("Effect on BAI (mm"^"2","y"^"-1",")"))))+#
			 theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
        scale_x_continuous(expand=c(0,0)) + scale_y_continuous(expand=c(0,0))+#
        ylim(-1,10)#
dev.off()
"processed_data/climate_markeryears.Rdata"
load("processed_data/climate_markeryears.Rdata")
summary(climate.markers)
climate.markers[climate.markers==]
climate.markers[climate.markers=="Missouri Ozark" & type=="tmean"]
climate.markers[climate.markers=="Missouri Ozark" & type=="tmean",]
climate.markers[climate.markers=="Missouri Ozark" & climate.markers$type=="tmean",]
climate.markers
climate.markers[climate.markers=="Missouri Ozark" & climate.markers$type=="tmean",]
climate.markers[climate.markers$Site=="Missouri Ozark" & climate.markers$type=="tmean",]
climate.markers[climate.markers$Site=="Morgan Monroe State Park" & climate.markers$type=="tmean",]
climate.markers[climate.markers$Site=="Oak Openings Toledo" & climate.markers$type=="tmean",]
climate.markers[climate.markers$Site=="Harvard" & climate.markers$type=="tmean",]
climate.markers[climate.markers$Site=="Howland" & climate.markers$type=="tmean",]
climate.markers[climate.markers$Site=="Missouri Ozark" & climate.markers$type=="precip",]
climate.markers[climate.markers$Site=="Morgan Monroe State Park" & climate.markers$type=="precip",]
climate.markers[climate.markers$Site=="Oak Openings Toledo" & climate.markers$type=="precip",]
climate.markers[climate.markers$Site=="Harvard" & climate.markers$type=="precip",]
climate.markers[climate.markers$Site=="Howland" & climate.markers$type=="precip",]
library(mgcv)#
library(ggplot2)#
library(car)#
# Christy's GAMM code#
#
# gam1 <- gamm(Y ~  s(Biomass, bs="cr", k=3, by=PFT) + s(tair, k=k, by=PFT) + s(precipf, k=k, by=PFT) + s(CO2, k=k, by=PFT), random=list(PlotID=~1), data=data) #
#
# Loading in my data#
#
data.use <- read.csv("processed_data/AllSites_tree_plus_climate_and_BA.csv", header=T)#
#
data.use$group <- data.use$Species#
data.use$group <- recode(data.use$group, "'CAOV' = 'CARYA'; 'CACO' = 'CARYA'; #
  							'CATE' = 'CARYA'; 'ACSAC' = 'ACSA'; 'BEAL' = 'BETULA'; 'BELE' = 'BETULA'; 'QUMU' = 'QUAL'")#
#
data.use$group.plot <- as.factor(paste(data.use$group, data.use$PlotID, sep="."))#
#
data.use$Canopy.Class <- recode(data.use$Canopy.Class, "'C' = 'D'")#
summary(data.use)#
# reducing the amount of data for the test runs#
sites.use <- c("Harvard", "Howland", "Morgan Monroe State Park", "Oak Openings Toledo", "Missouri Ozark")#
#
test <- data.use[data.use$Site %in% sites.use & !is.na(data.use$RW) & !is.na(data.use$BA.inc),]#
summary(test)#
#
test$group.cc <- as.factor(paste(test$group, test$Canopy.Class, sep="."))#
summary(test)#
# Get a list of what predictors & responses I'm using#
predictors.all <- c("tmean", "precip", "Species", "dbh.recon", "Canopy.Class", "spp.plot", "group", "group.plot", "group.cc", "Site") #
#
# Getting rid of observations that have NAs in the important variables#
test <- test[complete.cases(test[,predictors.all]),]#
test <- test[test$Live.Dead=="LIVE" & !test$Canopy.Class=="F",]#
#
# Subsetting to a set of species that we have enough data to feel good about#
#species.use <- c("TSCA", "QURU", "ACRU", "BEAL", "ACSA", "LITU", "QUAL", "CAOV", "CACO", "CATE", "JUVI", "QUVE", "PCRU", "THOC", "PIST")#
group.use <- c("ACRU", "ACSA", "BETULA", "CARYA", "FAGR", "FRAX", "PIST", "QUAL", "QURU", "QUVE", "SAAL", "TSCA", "ULRU")#
#
test <- test[test$group %in% group.use,]#
#
summary(test)#
#
par(new=F)#
plot(test[test$TreeID=="MMA003", "BA.inc"]~ test[test$TreeID=="MMA003","Year"], type="l")#
test$log.dbh <- log(test$dbh.recon)#
summary(test)#
#
summary(test)#
summary(test$Live.Dead)#
summary(test$Canopy.Class)#
# RW <- test$RW#
# temp <- test$tmean#
# precip <- test$precip#
# canopy <- test$Canopy.Class#
# size <- test$DBH..cm.#
# species <- unique(test$Species)#
# library(ggplot2)#
# ggplot(data=test) +#
   # facet_wrap(~PlotID) +#
   # geom_histogram(aes(x=dbh.recon))#
# ggplot(data=test) +#
   # facet_wrap(~Species) +#
   # geom_histogram(aes(x=dbh.recon))#
# hist(test$dbh.recon)#
# test2 <- test[test$group %in% c("QURU", "ACRU") & test$Year>=1980,]#
# test2 <- test[test$group %in% c("QURU", "ACRU"),]#
test2 <- test[test$Site %in% c("Morgan Monroe State Park", "Harvard"), ]#
# test2$log.dbh <- log(test2$dbh.recon)#
# summary(test2)#
summary(test)#
test[test$BA.inc==0, "BA.inc"] <- 1e-6#
save(test, file="ch2_combined_data_use.Rdata")#
# test.gam3 <- test#
# test.gam3$Canopy.Class <- recode(test.gam3$Canopy.Class, "'C' = 'D'")#
# summary(test.gam3)
library(ggplot2)#
require(car)#
#
load(file="processed_data/gamm_weights/gam2_weights.Rdata")#
#
summary(gam2.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] <- exp(gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] )#
othervars <- c("Year", "Site", "Canopy.Class", "Model")#
#
data.graph1 <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam2.weights[gam2.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam2.weights$wts.check <- rowSums(abs(gam2.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam2.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$Canopy.Class, data.graph$Site, decreasing=F),]#
plot.rgb <- function(STATE, CC, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.precip"   ]))) }   # blue#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))#
#
# Plotting the Obs and modeled with influence coloring#
pdf("figures/Prelim_Figures/gam2_canopyclass_BAI_limiting_factors.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State~Canopy.Class, scale="free") +#
	scale_x_continuous(expand=c(0,0)) +#
	scale_y_continuous(expand=c(0,0)) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_line(aes(x=Year, y=BA.inc), size=2, alpha=0.5) +#
	geom_ribbon(aes(x=Year, ymin=BA.inc.lwr, ymax=BA.inc.upr), alpha=0.3) +#
	geom_line(aes(x=Year, y = 0), linetype="dashed") +#
	plot.rgb("MA", "C", 2) +#
	plot.rgb("MA", "D", 2) +#
	plot.rgb("MA", "I", 2) +#
	plot.rgb("MA", "S", 2) +#
	plot.rgb("ME", "C", 2) +#
	plot.rgb("ME", "D", 2) +#
	plot.rgb("ME", "I", 2) +#
	plot.rgb("ME", "S", 2) +#
	plot.rgb("MO", "C", 2) +#
	plot.rgb("MO", "D", 2) +#
	plot.rgb("MO", "I", 2) +#
	plot.rgb("MO", "S", 2) +#
	plot.rgb("IN", "C", 2) +#
	plot.rgb("IN", "D", 2) +#
	plot.rgb("IN", "I", 2) +#
	plot.rgb("IN", "S", 2) +#
	plot.rgb("OH", "C", 2) +#
	plot.rgb("OH", "D", 2) +#
	plot.rgb("OH", "I", 2) +#
	plot.rgb("OH", "S", 2) +#
	labs(title= "Canopy Class", x="Year", y = expression(bold(paste("BAI (mm"^"2", "y"^"-1",")")))) +#
	theme_bw()#
dev.off()		#
# Just plotting the BAI fits#
summary(data.graph)#
#
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
  scale_x_continuous(expand=c(0,0), name="Year") +#
  scale_y_continuous(expand=c(0,0), name="BAI") +#
  # facet_wrap(~TreeID, scales="free_y", space="free") +#
  # geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)#
#
load("processed_data/climate_markeryears.Rdata")#
summary(climate.markers)#
climate.markers$State <- recode(climate.markers$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")
pdf("figures/Prelim_Figures/gam2_influence_in_time.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State ~ Canopy.Class, scale="free") +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_line(aes(x=Year, y=fit.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=fit.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=fit.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Effect on BAI (mm"^"2", "y"^"-1",")"))))#
dev.off()	#
#
pdf("figures/Prelim_Figures/gam2_influence_in_time_weights.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
dev.off()
ggplot(data.graph) + facet_grid(State ~ Canopy.Class, scale="free") +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
	geom_line(aes(x=Year, y=fit.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=fit.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=fit.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Effect on BAI (mm"^"2", "y"^"-1",")"))))
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker))+#
	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
	scale_color_manual(values=c("dodgerblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker))+#
	scale_color_manual(values=c("dodgerblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
pdf("figures/Prelim_Figures/gam2_influence_in_time_weights_temp.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
dev.off()	#
#
pdf("figures/Prelim_Figures/gam2_influence_in_time_weights_precip.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker))+#
	scale_color_manual(values=c("dodgerblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme_bw()+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
dev.off()
library(ggplot2)#
library(car)#
load(file="processed_data/gamm_weights/gam1_weights.Rdata")#
#
summary(gam1.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam1.weights[,which(substr(names(gam1.weights),1,3)=="fit")] <- exp(gam1.weights[,which(substr(names(gam1.weights),1,3)=="fit")] )#
#
othervars <- c("Year", "Site", "group", "Model")#
#
data.graph1 <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam1.weights[gam1.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam1.weights$wts.check <- rowSums(abs(gam1.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam1.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$group, data.graph$Site, decreasing=F),]#
summary(data.graph)#
#
plot.rgb <- function(STATE, SPP, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$group==SPP,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.precip"   ]))) }   # blue#
#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))#
#
summary(data.graph[!data.graph$group %in% c("BETULA", "CARYA", "FAGR", "FRAX", "SAAL"),])
load("processed_data/climate_markeryears.Rdata")#
summary(climate.markers)#
climate.markers$State <- recode(climate.markers$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")
ggplot(data.graph) + facet_grid(group~State) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	 geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme_bw()+#
	labs(title= "Spp Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(group~State) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	 geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("lightblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme_bw()+#
	labs(title= "Spp Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(group~State) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	 geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("lightblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme_bw(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	labs(title= "Spp Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(group~State) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	 geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("lightblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	labs(title= "Spp Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(group~State) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	 geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("lightblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 1.5),#
        axis.line.y = element_line(color="black", size = 1.5))#
	labs(title= "Spp Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(group~State) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	 geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("lightblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))#
	labs(title= "Spp Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(group~State) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	 geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))#
	labs(title= "Spp Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
pdf("figures/prelim_figures/gam1_influence_in_time_weights_temp.pdf", width= 13, height = 8.5)#
#
ggplot(data.graph) + facet_grid(group~State) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	 geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))#
	labs(title= "Spp Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
#
dev.off()#
#
pdf("figures/prelim_figures/gam1_influence_in_time_weights_precip.pdf", width= 13, height = 8.5)#
#
ggplot(data.graph) + facet_grid(group~State) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	 geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("lightblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))#
	labs(title= "Spp Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
#
dev.off()
library(ggplot2)#
require(car)#
#
load(file="processed_data/gamm_weights/gam2_weights.Rdata")#
#
summary(gam2.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] <- exp(gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] )#
othervars <- c("Year", "Site", "Canopy.Class", "Model")#
#
data.graph1 <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam2.weights[gam2.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam2.weights$wts.check <- rowSums(abs(gam2.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam2.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$Canopy.Class, data.graph$Site, decreasing=F),]#
plot.rgb <- function(STATE, CC, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.precip"   ]))) }   # blue#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))#
#
# Plotting the Obs and modeled with influence coloring#
pdf("figures/Prelim_Figures/gam2_canopyclass_BAI_limiting_factors.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State~Canopy.Class, scale="free") +#
	scale_x_continuous(expand=c(0,0)) +#
	scale_y_continuous(expand=c(0,0)) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_line(aes(x=Year, y=BA.inc), size=2, alpha=0.5) +#
	geom_ribbon(aes(x=Year, ymin=BA.inc.lwr, ymax=BA.inc.upr), alpha=0.3) +#
	geom_line(aes(x=Year, y = 0), linetype="dashed") +#
	plot.rgb("MA", "C", 2) +#
	plot.rgb("MA", "D", 2) +#
	plot.rgb("MA", "I", 2) +#
	plot.rgb("MA", "S", 2) +#
	plot.rgb("ME", "C", 2) +#
	plot.rgb("ME", "D", 2) +#
	plot.rgb("ME", "I", 2) +#
	plot.rgb("ME", "S", 2) +#
	plot.rgb("MO", "C", 2) +#
	plot.rgb("MO", "D", 2) +#
	plot.rgb("MO", "I", 2) +#
	plot.rgb("MO", "S", 2) +#
	plot.rgb("IN", "C", 2) +#
	plot.rgb("IN", "D", 2) +#
	plot.rgb("IN", "I", 2) +#
	plot.rgb("IN", "S", 2) +#
	plot.rgb("OH", "C", 2) +#
	plot.rgb("OH", "D", 2) +#
	plot.rgb("OH", "I", 2) +#
	plot.rgb("OH", "S", 2) +#
	labs(title= "Canopy Class", x="Year", y = expression(bold(paste("BAI (mm"^"2", "y"^"-1",")")))) +#
	theme_bw()#
dev.off()		#
# Just plotting the BAI fits#
summary(data.graph)
load("processed_data/climate_markeryears.Rdata")#
summary(climate.markers)#
climate.markers$State <- recode(climate.markers$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))#
#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
pdf("figures/Prelim_Figures/gam2_influence_in_time_weights_temp.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))#
#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
dev.off()	#
#
pdf("figures/Prelim_Figures/gam2_influence_in_time_weights_precip.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker))+#
	scale_color_manual(values=c("dodgerblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))#
#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
dev.off()	#
# #---------------------------------------------------#
# # Plotting just MMF and Harvard for Ameridendro#
#
# sites.use2 <- c("Harvard", "Morgan Monroe State Park")#
#
# # Plotting the Obs and modeled with influence coloring#
# pdf("figures/gam2_canopyclass_BAI_limiting_factors_ameridendro.pdf", width= 13, height = 8.5)#
# ggplot(data.graph[data.graph$Site %in% sites.use2,]) + facet_grid(Canopy.Class~Site) +#
	# scale_x_continuous(expand=c(0,0), name="Year") +#
	# scale_y_continuous(expand=c(0,0), name="BAI") +#
	# # facet_wrap(~TreeID, scales="free_y", space="free") +#
	# # geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	# geom_line(aes(x=Year, y=BA.inc), size=2, alpha=0.5) +#
	# geom_ribbon(aes(x=Year, ymin=BA.inc.lwr, ymax=BA.inc.upr), alpha=0.3) +#
	# geom_line(aes(x=Year, y = 0), linetype="dashed") +#
	# plot.rgb("Harvard", "C", 3) +#
	# plot.rgb("Harvard", "D", 3) +#
	# plot.rgb("Harvard", "I", 3) +#
	# plot.rgb("Harvard", "S", 3) +#
	# plot.rgb("Morgan Monroe State Park", "C", 3) +#
	# plot.rgb("Morgan Monroe State Park", "D", 3) +#
	# plot.rgb("Morgan Monroe State Park", "I", 3) +#
	# plot.rgb("Morgan Monroe State Park", "S", 3) +#
	# poster.theme2#
# dev.off()		#
# # Just plotting the BAI fits#
# summary(data.graph)#
#
# ggplot(data.graph) + facet_wrap(group~Site) +#
  # scale_x_continuous(expand=c(0,0), name="Year") +#
  # scale_y_continuous(expand=c(0,0), name="BAI") +#
  # # facet_wrap(~TreeID, scales="free_y", space="free") +#
  # # geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
  # geom_line(aes(x=Year, y=fit.full), size=2, alpha=0.5) +#
  # geom_ribbon(aes(x=Year, ymin=fit.full.lwr, ymax=fit.full.upr), alpha=0.3)#
#
# # Plotting the Effects#
#
# pdf("figures/gam2_influence_in_time_ameridendro.pdf", width= 13, height = 8.5)#
# ggplot(data.graph[data.graph$Site %in% sites.use2,]) + facet_grid(Canopy.Class~Site) +#
	# scale_x_continuous(expand=c(0,0), name="Year") +#
	# scale_y_continuous(expand=c(0,0), name="Effect on RW (in mm)") +#
	# # facet_wrap(~TreeID, scales="free_y", space="free") +#
	# # geom_ribbon(data=gam1.weights[gam1.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	# geom_line(aes(x=Year, y=fit.tmean), size=2, color="red") +#
	# geom_line(aes(x=Year, y=fit.precip), size=2, color="blue") +#
	# geom_line(aes(x=Year, y=fit.dbh.recon), size=2, color="green") +#
	# poster.theme2#
# dev.off()	#
#
gam2.data.graph <- data.graph#
save(gam2.data.graph, file="processed_data/gam2_graph_data.Rdata")
library(ggplot2)#
library(car)#
load(file="processed_data/gamm_weights/gam4_weights.Rdata")#
#
summary(gam4.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.fits2 <- c("tmean.bai", "precip.bai", "dbh.bai", "fit.full.bai", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam4.weights[,which(substr(names(gam4.weights),1,3)=="fit")] <- exp(gam4.weights[,which(substr(names(gam4.weights),1,3)=="fit")] )#
#
othervars <- c("Year", "Site","Model")#
#
data.graph1 <- aggregate(gam4.weights[,factors.fits], by = gam4.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam4.weights[,factors.fits], by = gam4.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam4.weights[,factors.fits], by = gam4.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam4.weights[,factors.weights]), by = gam4.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam4.weights[,factors.weights]), by = gam4.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam4.weights[,factors.weights]), by = gam4.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam4.weights[gam4.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam4.weights$wts.check <- rowSums(abs(gam4.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam4.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$Site, decreasing=F),]#
summary(data.graph)#
#
plot.rgb <- function(STATE,SIZE){	geom_point(data=data.graph[data.graph$State==STATE,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE,"weight.precip"   ]))) }   # blue#
#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))
load("processed_data/climate_markeryears.Rdata")#
summary(climate.markers)#
climate.markers$State <- recode(climate.markers$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")
ggplot(data.graph) + facet_grid(State~.) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))#
#
	labs(title= "Site Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(State~.) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("lightblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))#
#
	labs(title= "Site Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(State~.) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
  	scale_color_manual(values=c("lightblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
	labs(title= "Site Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(State~.) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.5)+#
  	scale_color_manual(values=c("lightblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
	labs(title= "Site Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(State~.) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.5)+#
  	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
	labs(title= "Site Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
# Plotting the Effects#
pdf("figures/prelim_figures/gam4_influence_in_time_weights_temp.pdf", width= 13, height = 8.5)#
#
ggplot(data.graph) + facet_grid(State~.) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.5)+#
  	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
	labs(title= "Site Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
#
dev.off()#
#
pdf("figures/prelim_figures/gam4_influence_in_time_weights_precip.pdf", width= 13, height = 8.5)#
#
ggplot(data.graph) + facet_grid(State~.) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.5)+#
  	scale_color_manual(values=c("lightblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
	labs(title= "Site Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
#
dev.off()
library(ggplot2)#
require(car)#
#
load(file="processed_data/gamm_weights/gam2_weights.Rdata")#
#
summary(gam2.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] <- exp(gam2.weights[,which(substr(names(gam2.weights),1,3)=="fit")] )#
othervars <- c("Year", "Site", "Canopy.Class", "Model")#
#
data.graph1 <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam2.weights[,factors.fits], by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam2.weights[,factors.weights]), by = gam2.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam2.weights[gam2.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam2.weights$wts.check <- rowSums(abs(gam2.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam2.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$Canopy.Class, data.graph$Site, decreasing=F),]#
plot.rgb <- function(STATE, CC, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$Canopy.Class==CC,"weight.precip"   ]))) }   # blue#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.35)+#
	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker))+#
	scale_color_manual(values=c("dodgerblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.5)+#
	scale_color_manual(values=c("dodgerblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
pdf("figures/Prelim_Figures/gam2_influence_in_time_weights_temp.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.5)+#
	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
dev.off()	#
#
pdf("figures/Prelim_Figures/gam2_influence_in_time_weights_precip.pdf", width= 13, height = 8.5)#
ggplot(data.graph) + facet_grid(State~Canopy.Class) +#
	geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.5)+#
	scale_color_manual(values=c("dodgerblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), alpha=0.25, fill="red") +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), alpha=0.25, fill="blue") +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), alpha=0.25, fill="green") +#
#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
	labs(title= "Canopy model", x= expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
dev.off()
library(ggplot2)#
library(car)#
load(file="processed_data/gamm_weights/gam1_weights.Rdata")#
#
summary(gam1.weights)#
factors.fits <- c("fit.tmean", "fit.precip", "fit.dbh.recon", "fit.full", "BA.inc")#
factors.weights <- c("weight.tmean", "weight.dbh.recon", "weight.precip")#
#
# Transforming things back to BA.inc rather than log#
gam1.weights[,which(substr(names(gam1.weights),1,3)=="fit")] <- exp(gam1.weights[,which(substr(names(gam1.weights),1,3)=="fit")] )#
#
othervars <- c("Year", "Site", "group", "Model")#
#
data.graph1 <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph1[,paste(factors.fits, "upr", sep=".")] <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.fits]#
#
data.graph1[,paste(factors.fits, "lwr", sep=".")] <- aggregate(gam1.weights[,factors.fits], by = gam1.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.fits]#
#
summary(data.graph1)#
#
data.graph2 <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= mean, na.rm=T)#
#
data.graph2[,paste(factors.weights, "upr", sep=".")] <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= quantile, prob= 0.975, na.rm=T)[,factors.weights]#
#
data.graph2[,paste(factors.weights, "lwr", sep=".")] <- aggregate(abs(gam1.weights[,factors.weights]), by = gam1.weights[,othervars], FUN= quantile, prob= 0.025, na.rm=T)[,factors.weights]#
#
summary(data.graph2)#
#
data.graph <- merge(data.graph1, data.graph2, all.x=T, all.y=T)#
#
# data.graph <- gam1.weights[gam1.weights$TreeID== "MMA014",]#
summary(data.graph)#
gam1.weights$wts.check <- rowSums(abs(gam1.weights[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
data.graph$wts.check <- rowSums(abs(data.graph[,c("weight.tmean", "weight.precip", "weight.dbh.recon")]))#
#
summary(gam1.weights)#
summary(data.graph)#
#
# Ordering the data for graphing#
#
data.graph<- data.graph[order(data.graph$Year, data.graph$group, data.graph$Site, decreasing=F),]#
summary(data.graph)#
#
plot.rgb <- function(STATE, SPP, SIZE){	geom_point(data=data.graph[data.graph$State==STATE & data.graph$group==SPP,],aes(x=Year, y=fit.full), size=SIZE,#
  		        color=rgb(abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.tmean"     ]), # red#
                        abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.dbh.recon"     ]), # green#
                        abs(data.graph[data.graph$State==STATE & data.graph$group==SPP,"weight.precip"   ]))) }   # blue#
#
# Plotting the Obs and modeled with influence coloring#
data.graph$State <- recode(data.graph$Site, "'Howland' = 'ME';'Harvard' = 'MA';'Morgan Monroe State Park' = 'IN';'Missouri Ozark' = 'MO';'Oak Openings Toledo' = 'OH'")#
data.graph$State <- factor(data.graph$State, levels=c("MO", "IN", "OH", "MA", "ME"))#
#
summary(data.graph[!data.graph$group %in% c("BETULA", "CARYA", "FAGR", "FRAX", "SAAL"),])
ggplot(data.graph) + facet_grid(group~State) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	 geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.5)+#
  	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
	labs(title= "Spp Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))
pdf("figures/prelim_figures/gam1_influence_in_time_weights_temp.pdf", width= 13, height = 8.5)#
#
ggplot(data.graph) + facet_grid(group~State) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	 geom_vline(data=climate.markers[climate.markers$type=="tmean",],aes(xintercept=marker.year, color=marker), alpha=0.5)+#
  	scale_color_manual(values=c("red", "blue"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
	labs(title= "Spp Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
#
dev.off()#
#
pdf("figures/prelim_figures/gam1_influence_in_time_weights_precip.pdf", width= 13, height = 8.5)#
#
ggplot(data.graph) + facet_grid(group~State) +#
	# facet_wrap(~TreeID, scales="free_y", space="free") +#
	# geom_ribbon(data=gam4.weights[gam4.weights$data.type=="Model",], aes(x=Year, ymin=Y.rel.10.lo*100, ymax=Y.rel.10.hi*100), 	alpha=0.5) +#
	 geom_vline(data=climate.markers[climate.markers$type=="precip",],aes(xintercept=marker.year, color=marker), alpha=0.5)+#
  	scale_color_manual(values=c("lightblue", "brown"))+#
	geom_ribbon(aes(x=Year, ymin=weight.tmean.lwr, ymax=weight.tmean.upr), fill="red", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.precip.lwr, ymax=weight.precip.upr), fill="blue", alpha=0.25) +#
	geom_ribbon(aes(x=Year, ymin=weight.dbh.recon.lwr, ymax=weight.dbh.recon.upr), fill="green", alpha=0.25) +#
	geom_line(aes(x=Year, y=weight.tmean), size=1, color="red") +#
	geom_line(aes(x=Year, y=weight.precip), size=1, color="blue") +#
	geom_line(aes(x=Year, y=weight.dbh.recon), size=1, color="green")+#
	labs(title= "Site", x="Year", y = "Model Fits") +#
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),#
panel.background = element_blank())+#
	theme(axis.line.x = element_line(color="black", size = 0.5),#
        axis.line.y = element_line(color="black", size = 0.5))+#
	labs(title= "Spp Model", x=expression(bold(paste("Year"))), y = expression(bold(paste("Limiting Factor Influence"))))#
#
dev.off()
